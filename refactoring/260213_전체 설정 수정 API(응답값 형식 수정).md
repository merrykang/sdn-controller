## 문제 상황
- 응답값 형식이 의도한 것과 다름
- 60초 미만의 값도 "~분"으로 표시하도록 되어 0분으로 표시되는 문제

---

## 해결 방법
#### 1. 응답값 형식이 의도한 것과 다름
- {swRunningConfig=0분, switchRefreshInterval={swRunningConfig=0분}, utmRefreshInterval={swRunningConfig=0분, switchRefreshInterval={swRunningConfig=0분}}} 같은 데이터가 ui_config_diff 테이블에 저장되지 않도록 수정
- 네 번째 인자로 diffMap(Map)을 넘기던 것을 switchRefreshInterval, utmRefreshInterval, apRefreshInterval 변수로 바꿔서 map의 형태로 저장되지 않도록 수정
- description (ex. 스위치 리프레쉬 주기) 같은 것을 key 로 사용하지 않고 필드 값(ex. switchRefreshInterval) 을 key로 사용하여 오류 최소화
- @SuppressWarnings("ConstantConditions") : 컴파일러 경고(warning)를 무시하라고 지시하는 어노테이션. 
```java
// 수정 전
collectAndPersistDiffs(...) {
  // ... 중략
  // 장비 페이지 리프레쉬
  addDiff(diffMap, "switchRefreshInterval", oldConfigs.getSwitchRefreshInterval(), diffMap);
  addDiff(diffMap, "utmRefreshInterval", oldConfigs.getUtmRefreshInterval(), diffMap);
  addDiff(diffMap, "apRefreshInterval", oldConfigs.getApRefreshInterval(), diffMap);

  // 저장
  if (!diffMap.isEmpty()) {
      String userId = userService.getUserId();
      Timestamp now = new Timestamp(System.currentTimeMillis());
      List<UiConfigDiff> rows = diffMap
              .entrySet().stream().map(e -> UiConfigDiff.builder().userId(userId).configName(e.getKey())
                      .configValue(e.getValue()).timestamp(now).build())
              .collect(java.util.stream.Collectors.toList());
      uiConfigDiffRepository.saveAll(rows);
  }
}

private void addDiff(Map<String, String> diffMap, String field, Object oldValue, Object newValue) {
  if (!Objects.equals(oldValue, newValue)) {
      String description = getSchemaDescription(UiConfigDTO.class, field);
      String valueStr = String.valueOf(newValue);
      String finalValue = valueStr;

      try {
          if (field.equals(HISTORY_RETENTION_MONTHS)) {
              finalValue = finalValue + "개월";
          } else {
              int seconds = Integer.parseInt(valueStr);
              int minutes = seconds / 60;
              finalValue = minutes + "분";
          }
      } catch (NumberFormatException ignore) {
      }
      diffMap.put(description, finalValue);
  }
}

@SuppressWarnings("ConstantConditions")
private void addDiffList(Map<String, String> diffMap, String field, List<String> oldList, List<String> newList) {
    List<String> oldNorm = (oldList == null)
            ? List.of()
            : oldList.stream().filter(Objects::nonNull).map(s -> s.trim().toLowerCase()).distinct().sorted()
                    .collect(Collectors.toList());
    List<String> newNorm = (newList == null)
            ? List.of()
            : newList.stream().filter(Objects::nonNull).map(s -> s.trim().toLowerCase()).distinct().sorted()
                    .collect(Collectors.toList());
    if (!Objects.equals(oldNorm, newNorm)) {
        String description = getSchemaDescription(UiConfigDTO.class, field);
        String valueStr = "[" + String.join(", ", newNorm) + "]";
        diffMap.put(description, valueStr);
    }
}
  
// 수정 후
addDiff(diffMap, "switchRefreshInterval", oldConfigs.getSwitchRefreshInterval(), switchRefreshInterval);
addDiff(diffMap, "utmRefreshInterval", oldConfigs.getUtmRefreshInterval(), utmRefreshInterval);
addDiff(diffMap, "apRefreshInterval", oldConfigs.getApRefreshInterval(), apRefreshInterval);

// 저장
if (!diffMap.isEmpty()) {
  // description 사라짐
  // ... 중략
  // 밑에서 바로 description 가져옴
  List<UiConfigDiff> rows = diffMap.entrySet().stream()
          .map(e -> UiConfigDiff.builder()
                  .userId(userId)
                  .configName(getSchemaDescription(UiConfigDTO.class, e.getKey()))
                  .configValue(e.getValue())
                  .timestamp(now)
                  .build())
          .collect(java.util.stream.Collectors.toList());
  uiConfigDiffRepository.saveAll(rows);
}

private void addDiff(Map<String, String> diffMap, String field, Object oldValue, Object newValue) {
  // map 형태는 받지 않도록 예외 처리
    if (newValue instanceof Map) {
        return;
    }
    if (!Objects.equals(oldValue, newValue)) {
      // description 사라짐 
      String valueStr = String.valueOf(newValue);
      String finalValue = valueStr;
      // ... 중략 
      // description 이 아니라 field값을 diffMap 에 저장 
      diffMap.put(field, finalValue);
    }
}

@SuppressWarnings("ConstantConditions")
    private void addDiffList(Map<String, String> diffMap, String field, List<String> oldList, List<String> newList) {
        // ... 중략
        if (!Objects.equals(oldNorm, newNorm)) {
          // description 사라짐
            String valueStr = "[" + String.join(", ", newNorm) + "]";
            diffMap.put(field, valueStr);
        }
    }

```

#### 2. 60초 미만의 값도 "~분"으로 표시하도록 되어 0분으로 표시되는 문제
```java
// 수정 전
private void addDiff(Map<String, String> diffMap, String field, Object oldValue, Object newValue) {
    if (!Objects.equals(oldValue, newValue)) {
        // ... 중략
        try {
            if (field.equals(HISTORY_RETENTION_MONTHS)) {
                finalValue = finalValue + "개월";
            } else {
                int seconds = Integer.parseInt(valueStr);
                int minutes = seconds / 60;
                finalValue = minutes + "분";
            }
        } catch (NumberFormatException ignore) {
        }
        diffMap.put(description, finalValue);
    }
}

// 수정 후 
try {
    if (field.equals(HISTORY_RETENTION_MONTHS)) {
        finalValue = finalValue + "개월";
    } else {
        int seconds = Integer.parseInt(valueStr);
        if (seconds < 60) {
            finalValue = seconds + "초";
        } else {
            int minutes = seconds / 60;
            finalValue = minutes + "분";
        }
    }
} catch (NumberFormatException ignore) {
}
```